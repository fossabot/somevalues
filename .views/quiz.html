		<main>
			<h1 pid="quiz.header"></h1>
			<p pid="quiz.preamble"></p>
			<button id="start" pid="quiz.start"></button>
		</main>
		<script>
var chosenMultipliers = [];

function shuffleFY(originalArray) {
	const array = originalArray.slice(0);

	for (let i = (array.length - 1); i > 0; i -= 1) {
		const randomIndex = Math.floor(Math.random() * (i + 1));
		[array[i], array[randomIndex]] = [array[randomIndex], array[i]];
	}
	
	return array;
}

function getResults() {
	let url = new URL(configCache.hostname + "results.html");
	for (let spectrum of spectrumCache) {
		let lvalPercent = Math.round(spectrum.lval / (spectrum.lval + spectrum.rval) * 100 * 10) / 10;
		url.searchParams.append(spectrum.spid, lvalPercent);
	}
	location.href = url;
}

async function initPrompt() {
	if (!chosenMultipliers.length) {
		document.getElementById("back").disabled = true
	}else {	
		document.getElementById("back").disabled = false
	}
	document.getElementById("prompt").innerHTML = localisationCache.prompts[promptCache[chosenMultipliers.length].qid];
	document.getElementById("progress").innerHTML = Math.round(chosenMultipliers.length / promptCache.length * 100) + "%";
}

function nextPrompt(multiplier) {
	for (let value of promptCache[chosenMultipliers.length].values) {
		let valSpectrum = spectrumCache.find(spectrum => spectrum.spid == value.spid);
		let result = multiplier * value.modifier;
		if (result < 0) {valSpectrum.lval += result * -1;}
		else {valSpectrum.rval += result;}
	}
	if (chosenMultipliers.length + 1 == promptCache.length) {
		getResults();
		return;
	}
	chosenMultipliers.push(multiplier);
	initPrompt();
}

function prevPrompt() {
	if (chosenMultipliers.length == 0) return;
	for (let value of promptCache[chosenMultipliers.length - 1].values) {
		let valSpectrum = spectrumCache.find(spectrum => spectrum.spid == value.spid);
		let result = chosenMultipliers[chosenMultipliers.length - 1] * value.modifier;
		if (result < 0) {valSpectrum.lval -= result * -1;}
		else {valSpectrum.rval -= result;}
	}
	chosenMultipliers.pop();
	initPrompt();
}

async function initLayout() {
	document.getElementsByTagName("main")[0].innerHTML = "";
	
	let progress = document.createElement("h2");
	progress.setAttribute("id", "progress");
	document.getElementsByTagName("main")[0].appendChild(progress);
	
	let prompt = document.createElement("p");
	prompt.setAttribute("id", "prompt");
	document.getElementsByTagName("main")[0].appendChild(prompt);

	for (let opinion of configCache.opinions) {
		let opbtn = document.createElement("button");
		opbtn.innerHTML = localisationCache.quiz.opinions[opinion.id];
		opbtn.setAttribute("id", opinion.id);
		opbtn.addEventListener("click",_ => nextPrompt(opinion.multiplier));
		document.getElementsByTagName("main")[0].appendChild(opbtn);	
	}
	
	let backbtn = document.createElement("button");
	backbtn.innerHTML = localisationCache.quiz.back;
	backbtn.setAttribute("id", "back");
	backbtn.addEventListener("click",_ => prevPrompt());
	document.getElementsByTagName("main")[0].appendChild(backbtn);
}

document.getElementById("start").onclick = async _ => {
	initLayout();
	
	promptCache = shuffleFY(promptCache);	
	
	spectrumCache.map(spectrum => {
		spectrum.lval = 0;
		spectrum.rval = 0;
	});

	initPrompt();
}
		</script>
